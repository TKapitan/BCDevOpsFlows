# Deploy to cloud

Use existing artifact and deploy the app to the cloud environment

## INPUT Parameters

| Name                  | Required  | Description                                                                                       | Default value         |
| :--                   | :-:       | :--                                                                                               | :--                   |
| deployToEnvironmentsNameFilter       | Yes       | Name of environment to deploy to. You can also use RegEx to specify filter for environment names to deploy to.    |                       |
| deploymentType        | No        | Type of delivery (CD or Release)                                                                  | CD                    |

## ENV INPUT variables

| Name                  | Description |
| :--                   | :-- |
| AL_ENVIRONMENTS       | Specifies details about all available environments. It must contain details about the environment used as $(environmentName) INPUT parameter. See chapter below for details about the content. |
| AL_APPDETAILS         | Specifies details about the app to deploy. Usually, this json is created by the StoreAppLocally step and should not be changed. You can override the value to deploy your custom apps in custom pipelines. See chapter below for details about the content. |
| AL_AUTHCONTEXTS_INTERNAL        | Specifies authentication context of the Entra app allowed to connect to Business Central. See chapter below for details about the content. In default setup, configure AL_AUTHCONTEXTS variable in your library and pass it to AL_AUTHCONTEXTS_INTERNAL variable in yaml file (secret variables must be explicitly configured in yaml files). |
| AL_SETTINGS           | BCDevOpsFlows settings as specified and generated by the ReadSettings. This should be always generated by pipeline by running ReadSettings step. |
| AL_BCCONTAINERHELPERPATH | If specified and valid, system will not download and import a new BCContainerHelper. This is usually configured in the background to prevent downloading/importing bccontainerhelper in every step. |
| AL_DEBUG | If set to 'true', pipelines generate additional logs that provides better details. If requesting support, you must provide log generated when this variable is enabled. |

### AL_ENVIRONMENTS example

**The variable must be compressed JSON!** The example below is structured json only for better readability.

```powershell
{
    "Specifies name of the environment for deployement. Must match the environment name.": {
        "environmentName": "Specifies name of the environment for deployement. Must match the environment name.",
        "buildMode": "Only 'Default' is currently supported.",
        "dependencyInstallMode": "Allowed values: ignore, install, upgrade or forceUpgrade",
        "authContextVariableName": "Name of the secret variable (NAME OF THE VARIABLE, NOT THE AUTHCONTEXT!!!) that contains authContext"
    },
    "---Environment2Name---": {
        "environmentName": "---Environment2Name---",
        "buildMode": "'default'",
        "dependencyInstallMode": "ignore",
        "authContextVariableName": "---authContext_YYY---"
    }
}
```

### AL_APPDETAILS example

**The variable must be compressed JSON!** The example below is structured json only for better readability.

```powershell
{
    "appFile": "Link to .app file to deploy."
    "appJsonFile": "Link to app.json file to deploy."
    "applicationVersion": "Application version of the app. Must have format X.Y.Z.W"
}
```

### AL_AUTHCONTEXT / AL_AUTHCONTEXTS_INTERNAL example

**The variable must be compressed JSON!** The example below is structured json only for better readability. Scripts use AL_AUTHCONTEXTS_INTERNAL. You should define AL_AUTHCONTEXTS as secret variable in your library and pass it to AL_AUTHCONTEXTS_INTERNAL in yaml files. Secret variables must be explicitly specified in yaml files, otherwise they are no available in pipeline.

```powershell
{
    "Specifies name of the authContext variable. This must match the value of authContextVariableName parameter in AL_ENVIRONMENTS environment variable": {
        "tenantID": "Specifies the tenant ID of the environment you want to deploy the app to.",
        "clientID": "Specifies the client ID of the app allowed to connect to the environment.",
        "clientSecret": "Specifies the client secret of the app allowed to connect to the environment."
    },
    "---authContext_YYY---": {
        "tenantID": "---TenantId---",
        "clientID": "'---clientID---'",
        "clientSecret": "---clientSecret---"
    }
}
```

## ENV OUTPUT variables

| Name                  | Description                                                                                                   |
| :--                   | :--                                                                                                           |
| AL_ENVIRONMENTURL     | The URL for the environment used for deployment                                                               |
| AL_BCCONTAINERHELPERPATH  | Path to used BC Container Helper module.  |
