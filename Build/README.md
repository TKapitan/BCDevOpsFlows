# Build

Build the app (and tests if configured) using configured build method (NuGet or BCContainerHelper)
NuGet
 - Quicker, does not require container. 
 - Tests cannot be run and not all validations are run.
 - Build with NuGet supports currently only ////Current artifact
BCContainerHelper
 - Run the Business Central app using BCContainerHelper Run-ALPipeline. Supports full validations but is slow.

## INPUT Parameters

| Name | Required | Description | Default value |
| :-- | :-: | :-- | :-- |
| artifact | Yes | ArtifactUrl to use for the build. |  |
| buildMode | | Specifies a mode to use for the build step. Supported values are Default, Translated. Translated creates the translation file during the build. | Default |

## ENV INPUT variables

| Name                  | Description |
| :--                   | :-- |
| AL_SETTINGS           | BCDevOpsFlows settings as specified and generated by the ReadSettings. This should be always generated by pipeline by running ReadSettings step. |
| AL_RUNWITH           | Specifies whether to use NuGet or BCContainerHelper to build the app. |
| AL_ALLOWPRERELEASE   | If set to true, pipeline will use public releases as well as preview/prerelease builds. |
| AL_DEBUG | If set to 'true', pipelines generate additional logs that provides better details. If requesting support, you must provide log generated when this variable is enabled. |

## ENV INPUT variables used only when AL_RUNWITH is NuGet

| Name | Description |
| :--                   | :-- |
| AL_BCDEVTOOLSFOLDER   | Specifies the folder used where the Business Central Developer Tools from Nuget are stored.   |
| AL_NUGETINITIALIZED   | If not set to true, the step fails. |

## ENV INPUT variables used only when AL_RUNWITH is BCContainerHelper

| Name | Description |
| :--                   | :-- |
| AL_BCCONTAINERHELPERPATH | If specified and valid, system will not download and import a new BCContainerHelper. This is usually configured in the background to prevent downloading/importing bccontainerhelper in every step. |
| AL_TRUSTEDNUGETFEEDS_INTERNAL | Specifies details about nuget feeds to be used to retrieve dependencies. You do not need to include Microsoft NuGet feeds as they are included automatically. See chapter below for details about the content. In default setup, configure AL_TRUSTEDNUGETFEEDS variable in your library and pass it to AL_TRUSTEDNUGETFEEDS_INTERNAL variable in yaml file (secret variables must be explicitly configured in yaml files). |

### AL_TRUSTEDNUGETFEEDS / AL_TRUSTEDNUGETFEEDS_INTERNAL example

**The variable must be compressed JSON!** The example below is structured json only for better readability. Scripts use AL_TRUSTEDNUGETFEEDS_INTERNAL. You should define AL_TRUSTEDNUGETFEEDS as secret variable in your library and pass it to AL_TRUSTEDNUGETFEEDS_INTERNAL in yaml files. Secret variables must be explicitly specified in yaml files, otherwise they are no available in pipeline.

```powershell
[
    {
        "Name":"---Feed 1 Name---",
        "Url":"---Feed 1 Url---",
        "Token":"---Feed 1 Token (with Read permission)---"
    },
    {
        "Name":"---Feed 2 Name---",
        "Url":"---Feed 2 Url---",
        "Token":"---Feed 2 Token (with Read permission)---"
    }
]
```

## ENV OUTPUT variables generated only when AL_RUNWITH is BCContainerHelper

| Name              | Description                                                                       |
| :--               | :--                                                                               |
| AL_CONTAINERNAME  | Name of the container used to run the AL Pipeline                                 |
| TestResults       | TestResults file name in format usable by PublishTestResults v2 Azure DevOps Step |